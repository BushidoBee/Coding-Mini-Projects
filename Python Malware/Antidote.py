#!/usr/bin/env python3

import os
from cryptography.fernet import Fernet #symmetric encryption method, cannot use w/o encryption key; 128-bit AES

# Initialize an empty array and begin decrypting the files
os.chdir('Python Malware')
all_files = []

# Gather all files for decryption; exclude Python both scripts and the key.
for file in os.listdir():
    if file == "Virus.py" or file == "crypt_key.key" or file == "Antidote.py":
        continue
    else:
        all_files.append(file)
    

print("All of the Following files have been decrypted, see the list below:")
print(all_files)


with open("crypt_key.key", "rb") as decryptkey:
    unlock = decryptkey.read()

# Use Crypto Key and decrypt all selected files
for selected_file in all_files:
    with open(selected_file, "rb") as sfile:
        fcontents = sfile.read()
        decrypt_contents = Fernet(unlock).decrypt(fcontents)
    with open(selected_file, "wb") as sfile:
        sfile.write(decrypt_contents)